<!DOCTYPE html>
<!-- Generated by pkgdown: do not edit by hand --><html lang="en-GB">
<head>
<meta http-equiv="Content-Type" content="text/html; charset=UTF-8">
<meta charset="utf-8">
<meta http-equiv="X-UA-Compatible" content="IE=edge">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Fuzzy String Comparison • levitate</title>
<!-- favicons --><link rel="icon" type="image/png" sizes="48x48" href="favicon-48x48.png">
<link rel="icon" type="”image/svg+xml”" href="favicon.svg">
<link rel="apple-touch-icon" sizes="180x180" href="apple-touch-icon.png">
<link rel="icon" sizes="any" href="favicon.ico">
<link rel="manifest" href="site.webmanifest">
<!-- jquery --><script src="https://cdnjs.cloudflare.com/ajax/libs/jquery/3.7.1/jquery.min.js" integrity="sha512-v2CJ7UaYy4JwqLDIrZUI/4hqeoQieOmAZNXBeQyjo21dadnwR+8ZaIJVT8EE2iyI61OV8e6M8PP2/4hpQINQ/g==" crossorigin="anonymous" referrerpolicy="no-referrer"></script><!-- Bootstrap --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/css/bootstrap.min.css" integrity="sha256-bZLfwXAP04zRMK2BjiO8iu9pf4FbLqX6zitd+tIvLhE=" crossorigin="anonymous">
<script src="https://cdnjs.cloudflare.com/ajax/libs/twitter-bootstrap/3.4.1/js/bootstrap.min.js" integrity="sha256-nuL8/2cJ5NDSSwnKD8VqreErSWHtnEP9E7AySL+1ev4=" crossorigin="anonymous"></script><!-- bootstrap-toc --><link rel="stylesheet" href="bootstrap-toc.css">
<script src="bootstrap-toc.js"></script><!-- Font Awesome icons --><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/all.min.css" integrity="sha256-mmgLkCYLUQbXn0B1SRqzHar6dCnv9oZFPEC1g1cwlkk=" crossorigin="anonymous">
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.12.1/css/v4-shims.min.css" integrity="sha256-wZjR52fzng1pJHwx4aV2AO3yyTOXrcDW7jBpJtTwVxw=" crossorigin="anonymous">
<!-- clipboard.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/clipboard.js/2.0.6/clipboard.min.js" integrity="sha256-inc5kl9MA1hkeYUt+EC3BhlIgyp/2jDIyBLS6k3UxPI=" crossorigin="anonymous"></script><!-- headroom.js --><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/headroom.min.js" integrity="sha256-AsUX4SJE1+yuDu5+mAVzJbuYNPHj/WroHuZ8Ir/CkE0=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/headroom/0.11.0/jQuery.headroom.min.js" integrity="sha256-ZX/yNShbjqsohH1k95liqY9Gd8uOiE1S4vZc+9KQ1K4=" crossorigin="anonymous"></script><!-- pkgdown --><link href="pkgdown.css" rel="stylesheet">
<script src="pkgdown.js"></script><meta property="og:title" content="Fuzzy String Comparison">
<meta property="og:description" content="Provides string similarity calculations inspired by the Python thefuzz package. Compare strings by edit distance, similarity ratio, best matching substring, ordered token matching and set-based token matching. A range of edit distance measures are available thanks to the stringdist package.">
<meta property="og:image" content="https://www.lewinfox.com/levitate/logo.png">
<!-- mathjax --><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/MathJax.js" integrity="sha256-nvJJv9wWKEm88qvoQl9ekL2J+k/RWIsaSScxxlsrv8k=" crossorigin="anonymous"></script><script src="https://cdnjs.cloudflare.com/ajax/libs/mathjax/2.7.5/config/TeX-AMS-MML_HTMLorMML.js" integrity="sha256-84DKXVJXs0/F8OTMzX4UR909+jtl4G7SPypPavF+GfA=" crossorigin="anonymous"></script><!--[if lt IE 9]>
<script src="https://oss.maxcdn.com/html5shiv/3.7.3/html5shiv.min.js"></script>
<script src="https://oss.maxcdn.com/respond/1.4.2/respond.min.js"></script>
<![endif]-->
</head>
<body data-spy="scroll" data-target="#toc">


    <div class="container template-home">
      <header><div class="navbar navbar-default navbar-fixed-top" role="navigation">
  <div class="container">
    <div class="navbar-header">
      <button type="button" class="navbar-toggle collapsed" data-toggle="collapse" data-target="#navbar" aria-expanded="false">
        <span class="sr-only">Toggle navigation</span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
        <span class="icon-bar"></span>
      </button>
      <span class="navbar-brand">
        <a class="navbar-link" href="index.html">levitate</a>
        <span class="version label label-default" data-toggle="tooltip" data-placement="bottom" title="">0.2.2</span>
      </span>
    </div>

    <div id="navbar" class="navbar-collapse collapse">
      <ul class="nav navbar-nav">
<li>
  <a href="articles/levitate.html">Get started</a>
</li>
<li>
  <a href="reference/index.html">Reference</a>
</li>
<li>
  <a href="news/index.html">Changelog</a>
</li>
      </ul>
<ul class="nav navbar-nav navbar-right">
<li>
  <a href="https://github.com/lewinfox/levitate/" class="external-link">
    <span class="fab fa-github fa-lg"></span>

  </a>
</li>
      </ul>
</div>
<!--/.nav-collapse -->
  </div>
<!--/.container -->
</div>
<!--/.navbar -->



      </header><div class="row">
  <div class="contents col-md-9">
<div class="section level1">
<div class="page-header"><h1 id="levitate-">levitate <img src="reference/figures/logo.png" align="right" height="139"><a class="anchor" aria-label="anchor" href="#levitate-"></a>
</h1></div>
<!-- badges: start -->

<p><code>levitate</code> is based on the Python <a href="https://github.com/seatgeek/thefuzz" class="external-link">thefuzz</a> (formerly <code>fuzzywuzzy</code>) package for fuzzy string matching. An R port of this already exists, but unlike <a href="https://github.com/mlampros/fuzzywuzzyR" class="external-link">fuzzywuzzyR</a>, <code>levitate</code> is written entirely in R with no external dependencies on <code>reticulate</code> or Python. It also offers a couple of extra bells and whistles in the form of vectorised functions.</p>
<p>View the docs at <a href="https://lewinfox.com/levitate/" class="external-link uri">https://lewinfox.com/levitate/</a>.</p>
<div class="section level2">
<h2 id="why-levitate">Why “<code>levitate</code>”?<a class="anchor" aria-label="anchor" href="#why-levitate"></a>
</h2>
<p>A common measure of string similarity is the <a href="https://en.wikipedia.org/wiki/Levenshtein_distance" class="external-link"><strong>Lev</strong>enshtein distance</a>, and the name was available on CRAN.</p>
<p><strong>NOTE</strong> The default distance metric is Optimal String Alignment (OSA), not Levenshtein distance. This is the default method used by the <code>stringdist</code> package, which <code>levitate</code> uses for distance calculations. OSA allows transpositions whereas Levenshtein distance does not. To use Levenshtein distance pass <code>method = "lv"</code> to any <code>lev_*()</code> functions.</p>
<div class="sourceCode" id="cb1"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="st">"01"</span>, <span class="st">"10"</span><span class="op">)</span> <span class="co"># Transpositions allowed by the default `method = "osa"`</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="st">"01"</span>, <span class="st">"10"</span>, method <span class="op">=</span> <span class="st">"lv"</span><span class="op">)</span> <span class="co"># No transpositions</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>A full list of distance metrics is available in <code><a href="https://rdrr.io/pkg/stringdist/man/stringdist-metrics.html" class="external-link">help("stringdist-metrics", package = stringdist)</a></code>.</p>
</div>
<div class="section level2">
<h2 id="installation">Installation<a class="anchor" aria-label="anchor" href="#installation"></a>
</h2>
<p>Install the released version from CRAN:</p>
<div class="sourceCode" id="cb2"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="https://rdrr.io/r/utils/install.packages.html" class="external-link">install.packages</a></span><span class="op">(</span><span class="st">"levitate"</span><span class="op">)</span></span></code></pre></div>
<p>Alternatively, you can install the development version from Github:</p>
<div class="sourceCode" id="cb3"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu">devtools</span><span class="fu">::</span><span class="fu">install_github</span><span class="op">(</span><span class="st">"lewinfox/levitate"</span><span class="op">)</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="examples">Examples<a class="anchor" aria-label="anchor" href="#examples"></a>
</h2>
<div class="section level3">
<h3 id="lev_distance">
<code>lev_distance()</code><a class="anchor" aria-label="anchor" href="#lev_distance"></a>
</h3>
<p>The edit distance is the number of additions, subtractions or substitutions needed to transform one string into another. Base R provides the <code><a href="https://rdrr.io/r/utils/adist.html" class="external-link">adist()</a></code> function to compute this. <code>levitate</code> provides <code><a href="reference/lev_distance.html">lev_distance()</a></code> which is powered by the <a href="https://github.com/markvanderloo/stringdist" class="external-link"><code>stringdist</code></a> package.</p>
<div class="sourceCode" id="cb4"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"bat"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"rats"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"rats"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 2</span></span></code></pre></div>
<p>The function can accept vectorised input. Where the inputs have a <code><a href="https://rdrr.io/r/base/length.html" class="external-link">length()</a></code> greater than 1 the results are returned as a vector unless <code>pairwise = FALSE</code>, in which case a matrix is returned.</p>
<div class="sourceCode" id="cb5"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"clog"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"log"</span>, <span class="st">"frog"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 1 2</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"clog"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"log"</span>, <span class="st">"frog"</span><span class="op">)</span>, pairwise <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt;      rat log frog</span></span>
<span><span class="co">#&gt; cat    1   3    4</span></span>
<span><span class="co">#&gt; dog    3   1    2</span></span>
<span><span class="co">#&gt; clog   4   1    2</span></span></code></pre></div>
<p>If at least one (or both) of the inputs is scalar (length 1) the result will be a vector. The elements of the vector are named based on the longer input (unless <code>useNames = FALSE</code>).</p>
<div class="sourceCode" id="cb6"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"clog"</span><span class="op">)</span>, <span class="st">"rat"</span><span class="op">)</span></span>
<span><span class="co">#&gt;  cat  dog clog </span></span>
<span><span class="co">#&gt;    1    3    4</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"log"</span>, <span class="st">"frog"</span>, <span class="st">"other"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt;   rat   log  frog other </span></span>
<span><span class="co">#&gt;     1     3     4     5</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_distance.html">lev_distance</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"log"</span>, <span class="st">"frog"</span>, <span class="st">"other"</span><span class="op">)</span>, useNames <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1 3 4 5</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lev_ratio">
<code>lev_ratio()</code><a class="anchor" aria-label="anchor" href="#lev_ratio"></a>
</h3>
<p>More useful than the edit distance, <code><a href="reference/lev_ratio.html">lev_ratio()</a></code> makes it easier to compare similarity across different strings. Identical strings will get a score of 1 and entirely dissimilar strings will get a score of 0.</p>
<p>This function behaves exactly like <code><a href="reference/lev_distance.html">lev_distance()</a></code>:</p>
<div class="sourceCode" id="cb7"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_ratio.html">lev_ratio</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"bat"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6666667</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_ratio.html">lev_ratio</a></span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"rats"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.75</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_ratio.html">lev_ratio</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"rats"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.5</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_ratio.html">lev_ratio</a></span><span class="op">(</span><span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"cat"</span>, <span class="st">"dog"</span>, <span class="st">"clog"</span><span class="op">)</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"rat"</span>, <span class="st">"log"</span>, <span class="st">"frog"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6666667 0.6666667 0.5000000</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lev_partial_ratio">
<code>lev_partial_ratio()</code><a class="anchor" aria-label="anchor" href="#lev_partial_ratio"></a>
</h3>
<p>If <code>a</code> and <code>b</code> are different lengths, this function compares all the substrings of the longer string that are the same length as the shorter string and returns the highest <code><a href="reference/lev_ratio.html">lev_ratio()</a></code> of all of them. E.g. when comparing <code>"actor"</code> and <code>"tractor"</code> we would compare <code>"actor"</code> with <code>"tract"</code>, <code>"racto"</code> and <code>"actor"</code> and return the highest score (in this case 1).</p>
<div class="sourceCode" id="cb8"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_partial_ratio.html">lev_partial_ratio</a></span><span class="op">(</span><span class="st">"actor"</span>, <span class="st">"tractor"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 1</span></span>
<span></span>
<span><span class="co"># What's actually happening is the max() of this result is being returned</span></span>
<span><span class="fu"><a href="reference/lev_ratio.html">lev_ratio</a></span><span class="op">(</span><span class="st">"actor"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"tract"</span>, <span class="st">"racto"</span>, <span class="st">"actor"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; tract racto actor </span></span>
<span><span class="co">#&gt;   0.2   0.6   1.0</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lev_token_sort_ratio">
<code>lev_token_sort_ratio()</code><a class="anchor" aria-label="anchor" href="#lev_token_sort_ratio"></a>
</h3>
<p>The inputs are tokenised and the tokens are sorted alphabetically, then the resulting strings are compared.</p>
<div class="sourceCode" id="cb9"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"Episode IV - Star Wars: A New Hope"</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"Star Wars Episode IV - New Hope"</span></span>
<span></span>
<span><span class="co"># Because the order of words is different the simple approach gives a low match ratio.</span></span>
<span><span class="fu"><a href="reference/lev_ratio.html">lev_ratio</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.3529412</span></span>
<span></span>
<span><span class="co"># The sorted token approach ignores word order.</span></span>
<span><span class="fu"><a href="reference/lev_token_sort_ratio.html">lev_token_sort_ratio</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.9354839</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lev_token_set_ratio">
<code>lev_token_set_ratio()</code><a class="anchor" aria-label="anchor" href="#lev_token_set_ratio"></a>
</h3>
<p>Similar to <code><a href="reference/lev_token_sort_ratio.html">lev_token_sort_ratio()</a></code> this function breaks the input down into tokens. It then identifies any common tokens between strings and creates three new strings:</p>
<div class="sourceCode" id="cb10"><pre class="sourceCode R"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a>x <span class="ot">&lt;-</span> {common_tokens}</span>
<span id="cb10-2"><a href="#cb10-2" tabindex="-1"></a>y <span class="ot">&lt;-</span> {common_tokens}{remaining_unique_tokens_from_string_a}</span>
<span id="cb10-3"><a href="#cb10-3" tabindex="-1"></a>z <span class="ot">&lt;-</span> {common_tokens}{remaining_unique_tokens_from_string_b}</span></code></pre></div>
<p>and performs three pairwise <code><a href="reference/lev_ratio.html">lev_ratio()</a></code> calculations between them (<code>x</code> vs <code>y</code>, <code>y</code> vs <code>z</code> and <code>x</code> vs <code>z</code>). The highest of those three ratios is returned.</p>
<div class="sourceCode" id="cb11"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="va">x</span> <span class="op">&lt;-</span> <span class="st">"the quick brown fox jumps over the lazy dog"</span></span>
<span><span class="va">y</span> <span class="op">&lt;-</span> <span class="st">"my lazy dog was jumped over by a quick brown fox"</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_ratio.html">lev_ratio</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.2916667</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_token_sort_ratio.html">lev_token_sort_ratio</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.6458333</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_token_set_ratio.html">lev_token_set_ratio</a></span><span class="op">(</span><span class="va">x</span>, <span class="va">y</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7435897</span></span></code></pre></div>
</div>
<div class="section level3">
<h3 id="lev_weighted_token_ratio">
<code>lev_weighted_token_ratio()</code><a class="anchor" aria-label="anchor" href="#lev_weighted_token_ratio"></a>
</h3>
<p>The <code>lev_weighted_*()</code> family of functions work slightly differently from the others. They always tokenise their input, and they allow you to assign different weights to specific tokens. This allows you to exert some influence over parts of the input strings that are more or less interesting to you.</p>
<p>For example, maybe you’re comparing company names from different sources, trying to match them up.</p>
<div class="sourceCode" id="cb12"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_ratio.html">lev_ratio</a></span><span class="op">(</span><span class="st">"united widgets, ltd"</span>, <span class="st">"utd widgets, ltd"</span><span class="op">)</span> <span class="co"># Note the typos</span></span>
<span><span class="co">#&gt; [1] 0.8421053</span></span></code></pre></div>
<p>These strings score quite highly already, but the <code>"ltd"</code> in each name isn’t very helpful. We can use <code><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio()</a></code> to reduce the impact of <code>"ltd"</code>.</p>
<p><strong>NOTE</strong> Because the tokenisation affects the score, we can’t compare the output of the <code>lev_weighted_*()</code> functions with the non-weighted versions. To get a baseline, call the weighted function without supplying a <code>weights</code> argument.</p>
<div class="sourceCode" id="cb13"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"united widgets, ltd"</span>, <span class="st">"utd widgets, ltd"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.8125</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"united widgets, ltd"</span>, <span class="st">"utd widgets, ltd"</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ltd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7744361</span></span></code></pre></div>
<p>De-weighting <code>"ltd"</code> has reduced the similarity score of the strings, which gives a more accurate impression of their similarity.</p>
<p>We can remove the effect of <code>"ltd"</code> altogether by setting its weight to zero.</p>
<div class="sourceCode" id="cb14"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"united widgets, ltd"</span>, <span class="st">"utd widgets, ltd"</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ltd <span class="op">=</span> <span class="fl">0</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7692308</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"united widgets"</span>, <span class="st">"utd widgets"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7692308</span></span></code></pre></div>
<p>De-weighting also works the other way - if the token to be weighted appears in one string but not the other, then de-weighting it <em>increases</em> the similarity score:</p>
<div class="sourceCode" id="cb15"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"utd widgets"</span>, <span class="st">"united widgets, ltd"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.625</span></span>
<span></span>
<span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"utd widgets"</span>, <span class="st">"united widgets, ltd"</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ltd <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.7518797</span></span></code></pre></div>
<div class="section level4">
<h4 id="limitations-of-token-weighting">Limitations of token weighting<a class="anchor" aria-label="anchor" href="#limitations-of-token-weighting"></a>
</h4>
<p><code><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio()</a></code> has a key limitation: tokens will only be weighted if:</p>
<ul>
<li>The token appears in the same position in both strings (i.e. it’s the first/second/third, etc. token in both)</li>
<li>OR the strings contain different numbers of tokens, and the corresponding token position in the other string is empty.</li>
</ul>
<p>This is probably easiest to see by example.</p>
<div class="sourceCode" id="cb16"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"utd widgets limited"</span>, <span class="st">"united widgets, ltd"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.65</span></span>
<span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"utd widgets limited"</span>, <span class="st">"united widgets, ltd"</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>ltd <span class="op">=</span> <span class="fl">0.1</span>, limited <span class="op">=</span> <span class="fl">0.1</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.65</span></span></code></pre></div>
<p>In this case the weighting has had no effect. Why not? Internally, the function has tokenised the strings as follows:</p>
<table class="table">
<thead><tr class="header">
<th>token_1</th>
<th>token_2</th>
<th>token_3</th>
</tr></thead>
<tbody>
<tr class="odd">
<td>“utd”</td>
<td>“widgets”</td>
<td>“limited”</td>
</tr>
<tr class="even">
<td>“united”</td>
<td>“widgets”</td>
<td>“ltd”</td>
</tr>
</tbody>
</table>
<p>Because the token <code>"ltd"</code> doesn’t appear in the same position in both strings, the function doesn’t apply any weights.</p>
<p>This is a deliberate decision; while in the example above it’s easy to say “well, clearly ltd and limited are the same thing so we ought to weight them”, how should we handle a less clear example?</p>
<div class="sourceCode" id="cb17"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"green eggs and ham"</span>, <span class="st">"spam spam spam spam"</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1176471</span></span>
<span><span class="fu"><a href="reference/lev_weighted_token_ratio.html">lev_weighted_token_ratio</a></span><span class="op">(</span><span class="st">"green eggs and ham"</span>, <span class="st">"spam spam spam spam"</span>, weights <span class="op">=</span> <span class="fu"><a href="https://rdrr.io/r/base/list.html" class="external-link">list</a></span><span class="op">(</span>spam <span class="op">=</span> <span class="fl">0.1</span>, eggs <span class="op">=</span> <span class="fl">0.5</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] 0.1176471</span></span></code></pre></div>
<p>In this case it’s hard to say what the “correct” approach would be. There isn’t a meaningful way of applying weights to dissimilar tokens. In situations like “ltd”/“limited”, a pre-cleaning or standardisation process might be helpful, but that is outside the scope of what <code>levitate</code> offers.</p>
<p>I recommend exploring <code><a href="reference/lev_weighted_token_sort_ratio.html">lev_weighted_token_sort_ratio()</a></code> and <code><a href="reference/lev_weighted_token_set_ratio.html">lev_weighted_token_set_ratio()</a></code> as they may give more useful results for some problems. Remember, <strong>weighting is going to be most useful when compared to the unweighted output of the same function</strong>.</p>
</div>
</div>
</div>
<div class="section level2">
<h2 id="ranking-functions">Ranking functions<a class="anchor" aria-label="anchor" href="#ranking-functions"></a>
</h2>
<p>A common problem in this area is “given a string x and a set of strings y, which string in y is most / least similar to x?”. <code>levitate</code> provides two functions to help with this: <code><a href="reference/lev_score_multiple.html">lev_score_multiple()</a></code> and <code><a href="reference/lev_best_match.html">lev_best_match()</a></code>.</p>
<p><code><a href="reference/lev_score_multiple.html">lev_score_multiple()</a></code> returns a ranked list of candidates. By default the highest-scoring is first.</p>
<div class="sourceCode" id="cb18"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_score_multiple.html">lev_score_multiple</a></span><span class="op">(</span><span class="st">"bilbo"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gandalf"</span>, <span class="st">"frodo"</span>, <span class="st">"legolas"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; $frodo</span></span>
<span><span class="co">#&gt; [1] 0.2</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $legolas</span></span>
<span><span class="co">#&gt; [1] 0.1428571</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $gandalf</span></span>
<span><span class="co">#&gt; [1] 0</span></span></code></pre></div>
<p><code><a href="reference/lev_best_match.html">lev_best_match()</a></code> returns the best matched string without any score information.</p>
<div class="sourceCode" id="cb19"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_best_match.html">lev_best_match</a></span><span class="op">(</span><span class="st">"bilbo"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gandalf"</span>, <span class="st">"frodo"</span>, <span class="st">"legolas"</span><span class="op">)</span><span class="op">)</span></span>
<span><span class="co">#&gt; [1] "frodo"</span></span></code></pre></div>
<p>Both functions take a <code>.fn</code> argument which allows you to select a different ranking function. The default is <code><a href="reference/lev_ratio.html">lev_ratio()</a></code> but you can pick another or write your own. See <code><a href="reference/lev_score_multiple.html">?lev_score_multiple</a></code> for details.</p>
<p>You can also reverse the direction of sorting by using <code>decreasing = FALSE</code>. This reverses the sort direction so <em>lower</em> scoring items are preferred. This may be helpful if you’re using a distance rather than a similarity measure, or if you want to return least similar strings.</p>
<div class="sourceCode" id="cb20"><pre class="downlit sourceCode r">
<code class="sourceCode R"><span><span class="fu"><a href="reference/lev_score_multiple.html">lev_score_multiple</a></span><span class="op">(</span><span class="st">"bilbo"</span>, <span class="fu"><a href="https://rdrr.io/r/base/c.html" class="external-link">c</a></span><span class="op">(</span><span class="st">"gandalf"</span>, <span class="st">"frodo"</span>, <span class="st">"legolas"</span><span class="op">)</span>, decreasing <span class="op">=</span> <span class="cn">FALSE</span><span class="op">)</span></span>
<span><span class="co">#&gt; $gandalf</span></span>
<span><span class="co">#&gt; [1] 0</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $legolas</span></span>
<span><span class="co">#&gt; [1] 0.1428571</span></span>
<span><span class="co">#&gt; </span></span>
<span><span class="co">#&gt; $frodo</span></span>
<span><span class="co">#&gt; [1] 0.2</span></span></code></pre></div>
</div>
<div class="section level2">
<h2 id="porting-code-from-thefuzz-or-fuzzywuzzyr">Porting code from <code>thefuzz</code> or <code>fuzzywuzzyR</code>
<a class="anchor" aria-label="anchor" href="#porting-code-from-thefuzz-or-fuzzywuzzyr"></a>
</h2>
<p>Results differ between <code>levitate</code> and <code>thefuzz</code>, not least because <a href="https://github.com/markvanderloo/stringdist" class="external-link"><code>stringdist</code></a> offers several possible similarity measures. Be careful if you are porting code that relies on hard-coded or learned cutoffs for similarity measures.</p>
</div>
</div>
  </div>

  <div class="col-md-3 hidden-xs hidden-sm" id="pkgdown-sidebar">
    <div class="links">
<h2 data-toc-skip>Links</h2>
<ul class="list-unstyled">
<li><a href="https://cloud.r-project.org/package=levitate" class="external-link">View on CRAN</a></li>
<li><a href="https://github.com/lewinfox/levitate/" class="external-link">Browse source code</a></li>
<li><a href="https://github.com/lewinfox/levitate/issues" class="external-link">Report a bug</a></li>
</ul>
</div>

<div class="license">
<h2 data-toc-skip>License</h2>
<ul class="list-unstyled">
<li><a href="LICENSE.html">Full license</a></li>
<li><small><a href="https://www.r-project.org/Licenses/GPL-3" class="external-link">GPL-3</a></small></li>
</ul>
</div>


<div class="citation">
<h2 data-toc-skip>Citation</h2>
<ul class="list-unstyled">
<li><a href="authors.html#citation">Citing levitate</a></li>
</ul>
</div>

<div class="developers">
<h2 data-toc-skip>Developers</h2>
<ul class="list-unstyled">
<li>Lewin Appleton-Fox <br><small class="roles"> Author, maintainer, copyright holder </small>   </li>
</ul>
</div>

<div class="dev-status">
<h2 data-toc-skip>Dev status</h2>
<ul class="list-unstyled">
<li><a href="https://cran.r-project.org/package=levitate" class="external-link"><img src="http://cranlogs.r-pkg.org/badges/grand-total/levitate"></a></li>
<li><a href="https://github.com/lewinfox/levitate/actions/workflows/R-CMD-check.yaml" class="external-link"><img src="https://github.com/lewinfox/levitate/actions/workflows/R-CMD-check.yaml/badge.svg" alt="R-CMD-check"></a></li>
</ul>
</div>

  </div>
</div>


      <footer><div class="copyright">
  <p></p>
<p>Developed by Lewin Appleton-Fox.</p>
</div>

<div class="pkgdown">
  <p></p>
<p>Site built with <a href="https://pkgdown.r-lib.org/" class="external-link">pkgdown</a> 2.1.3.</p>
</div>

      </footer>
</div>






  </body>
</html>
